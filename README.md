# Customer Specific Product Sales Forecasting
Django Rest API Framework for VAR forecasting on future product sales quantity by specific customer

Model training python script is at https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/blob/main/research/Model%20training.ipynb

## Objectives
1.  To identify the demand profile of each time-series of a product sale by a customer. 
2.	To train time-series customer demand forecasting models to predict a specific productâ€™s demand by a specific customer.
3.	To evaluate the performance of demand forecasting models trained.
4.	To deploy a demand forecasting model to be used in actual-world applications.

## Data Source
Past 2 years of sales invoice data are extracted from a local bun distributor. Both customer and product information has been anonymized here.

## Results
### Time-series extraction
This to create time-series for each product-customer combination from current dataset. The result multivariate time-series have values spanning over two years with 1 day difference between data points, so each time-series has a total of 730 date values. In order to do so, those date values must be present in the dataset before individual time-series can be extracted. Hence, those dates are inserted into the dataset for each product-customer combination. If no sale transaction occurred at a particular date for a specific combination, value 0 is inserted as sales quantity at that date. The new dataset generated now have sales data for every product-customer combination over two years. From this dataset, individual time-series for each product-customer combination is extracted. Those time-series are combined to form a multivariate time-series.
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/0ed65561-5374-4fb0-b9df-6ede585a0d0d)

### Demand profile identification
Demand profile is determined based on ADI and CV2 scores of each time-series. It is found that majority of the time-series are showing intermittent profile characteristics.
Intermitttent: 31061
Lumpy: 2474
Smooth: 47

### Train-test split
Multivariate time-series is slitted where the last 30 days are used as test set while the remaining are used as training set.

### Data preprocessing
3 preprocessing techniques have been applied: min-max normalization, PCA reduction and data differencing.
Min-max normalization is performed so that all sales quantities fall within the same range.
PCA reduction lowers dimenisionality of multivariate time-series to avoid the curse of high dimensionality.
1 level of data diffferencing is performed to remove seasonality from the multivariate time-series so that they are stationary.

### Demand forecasting
Vector Autoregressive (VAR), ARIMA and Theta models are trained. 

Figures below show examples of comparison of the sales quantity of a product by a customer between actual values in the test set and the forecasted values generated by each model over 30 days.
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/24c14064-2f40-4b29-8aa8-a044625337c3)
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/a726d631-eae2-419b-9ad5-2cb96cc913f5)
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/8fdd7609-d75f-4956-8532-7bb7ee4ecc44)

Figures above show the comparison between VAR model forecasted and actual sales quantities of product-customer combination examples

![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/eb67d5b3-1ac6-4492-a32b-116f20586fb2)
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/da420e6e-1bd7-4630-98bb-0ea1ab3bbefe)
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/732227d4-292b-4502-8423-8bc0d548bc89)

Figures above show the comparison between ARIMA model forecasted and actual sales quantities of product-customer combination examples

![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/c521719d-5fa2-4e28-aa91-f3bb61aa730f)
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/4ba3e8d3-5530-43f0-a693-4e5342f6195b)
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/3c81f6bd-bdfd-43b9-bb16-75594b7204b1)

Figures above show the comparison between Theta model forecasted and actual sales quantities of product-customer combination examples

![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/094a9487-a779-470b-a80e-e183e97f9096)

Based on table above, VAR model is the best performing model because it has the lowest score in all metrices.

Although VAR model achieves a low RMSE score, there are some instances where it did not able to forecast sales accurately for certain time-series as shown as figure below.
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/1eacd1a7-e979-4815-acc4-9c2c989aee1f)

While most RMSE scores have low values, there are cases where both RMSE have extreme values. This behaviour is observed in all 3 models trained. Those extreme values show that all models are cannot accurately model certain time-series components. This behaviour may be because most time-series components in the multivariate time-series have intermittent demand profiles.

### Model deployment
VAR model trained is deployed as web service using Django. When using the web service, a user has to specify the product, customer and number of days to forecast in the body of his request as shown in figure below.
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/95a01be9-8097-4ac0-89db-06190950e50e)

When Django receives this request, VAR model first generates forecast for the number of days specified in the request. Using product and customer values, a univariate forecasted time-series is extracted to represent the demand forecast for that product by that customer. This univariate time-series is then sent back to user as web service response as shown in figure below.
![image](https://github.com/Tan-Pheng-Chiang/customer_specific_product_sales_forecasting/assets/131639318/70dd58ac-7e95-4a7d-aac7-e223f99cdb05)

